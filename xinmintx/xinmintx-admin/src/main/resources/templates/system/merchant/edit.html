<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('修改商家信息')" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-merchant-edit" th:object="${merchant}">
            <input id="three" th:value="*{merchantCategoryDetail}" type="hidden">
            <input name="id" th:field="*{id}" type="hidden">
            <div class="form-group">    
                <label class="col-sm-3 control-label">姓名：</label>
                <div class="col-sm-8">
                    <input name="name" th:field="*{name}" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">商户名称：</label>
                <div class="col-sm-8">
                    <input name="merchantName" th:field="*{merchantName}" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">公告通知：</label>
                <div class="col-sm-8">
                    <input name="announcement" th:field="*{announcement}" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">身份证号：</label>
                <div class="col-sm-8">
                    <input name="idcard" th:field="*{idcard}" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">手机号：</label>
                <div class="col-sm-8">
                    <input name="cellphone" th:field="*{cellphone}" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">银行卡号：</label>
                <div class="col-sm-8">
                    <input name="bankCard" th:field="*{bankCard}" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">入驻类型：</label>
                <div class="col-sm-8">
                    <select name="merchantType" th:field="*{merchantType}" class="form-control m-b" onchange="selectMerchantType()">
                        <option value="1">普通商户</option>
                        <option value="2">黄金商户</option>
                        <option value="3">社区商户</option>
                    </select>
                </div>
            </div>
            <div class="form-group" id="category" style="display: none;">
                <label class="col-sm-3 control-label">商户分类：</label>
                <div class="col-sm-8">
                    <select id="threeLevel" name="merchantCategory" th:field="*{merchantCategory}" class="form-control m-b" onchange="threeLevelType()">
                        <option value="1">美食</option>
                        <option value="2">水果</option>
                        <option value="3">夜宵</option>
                        <option value="4">果蔬商超</option>
                    </select>
                </div>
            </div>
            <div class="col-md-12" id="threeType" onchange="threeType()">
                <div class="form-group">
                    <label class="col-sm-3 control-label">所有分类：</label>
                    <input type="checkbox" name="threeType" value="1" id="inlineCheckbox1"/>水果
                    <input type="checkbox" name="threeType" value="2" id="inlineCheckbox2"/>水产
                    <input type="checkbox" name="threeType" value="3" id="inlineCheckbox3"/>蔬菜
                    <input type="checkbox" name="threeType" value="4" id="inlineCheckbox4"/>肉类
                    <input type="checkbox" name="threeType" value="5" id="inlineCheckbox5"/>粮油调味

                    <!--<div class="col-sm-9">
                        <label class="check-box">
                            <div class="icheckbox-blue">
                                <input type="checkbox" name="threeType" value="1" id="inlineCheckbox1" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
                            </div>水果</label>
                        <label class="check-box">
                            <div class="icheckbox-blue">
                                <input type="checkbox" name="threeType" value="2" id="inlineCheckbox2" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
                            </div>水产</label>
                        <label class="check-box">
                            <div class="icheckbox-blue">
                                <input type="checkbox" name="threeType" value="3" id="inlineCheckbox3" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
                            </div>蔬菜</label>
                        <label class="check-box">
                            <div class="icheckbox-blue">
                                <input type="checkbox" name="threeType" value="4" id="inlineCheckbox4" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
                            </div>肉类</label>
                        <label class="check-box">
                            <div class="icheckbox-blue">
                                <input type="checkbox" name="threeType" value="5" id="inlineCheckbox5" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
                            </div>粮油调味</label>
                    </div>-->
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">桌数：</label>
                <div class="col-sm-8">
                    <input name="merchantTable" th:field="*{merchantTable}" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">商户地址：</label>
                <div class="col-sm-8">
                    <input name="address" th:field="*{address}" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">地区：</label>
                <div class="col-sm-8">
                    <select class="col-sm-4" id="province" onchange="getCity()"></select>
                    <select class="col-sm-4" id="city" onchange="getDistrict()"></select>
                    <select class="col-sm-4" id="regionCode" name="regionCode"></select>
                    <input type="hidden" id="province1" th:value="${province}">
                    <input type="hidden" id="city1" th:value="${city}">
                    <input type="hidden" id="district1" th:value="${district}">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">商户手续费：</label>
                <div class="col-sm-8">
                    <input name="serviceCharge" th:field="*{serviceCharge}" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">是否审核：</label>
                <div class="col-sm-8">
                    <select name="isReview" th:field="*{isReview}" class="form-control">
                        <option value="0">未审核</option>
                        <option value="1">已审核</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">起提金额：</label>
                <div class="col-sm-8">
                    <input name="amountRaised" th:field="*{amountRaised}" class="form-control" type="number" required>
                </div>
            </div>
<!--            <div class="form-group">-->
<!--                <label class="col-sm-3 control-label">商户头像：</label>-->
<!--                <div class="col-sm-6">-->
<!--                    <input name="avatar" type="hidden" th:value="${merchant.avatar}">-->
<!--                    <img th:src="${merchant.avatar}" style="width: 300px;height: 200px;">-->
<!--                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">-->
<!--                </div>-->
<!--            </div>-->
            <div class="form-group">
                <label class="col-sm-3 control-label">上传身份证正面：</label>
                <div class="col-sm-6">
                    <input name="idcardFront" type="hidden" th:value="${merchant.idcardFront}">
                    <img th:src="${merchant.idcardFront}" style="width: 300px;height: 200px;">
                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">上传身份证反面：</label>
                <div class="col-sm-6">
                    <input name="idcardBack" type="hidden" th:value="${merchant.idcardBack}">
                    <img th:src="${merchant.idcardBack}" style="width: 300px;height: 200px;">
                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">
                </div>
            </div>
<!--            <div class="form-group">-->
<!--                <label class="col-sm-3 control-label">上传银行卡正面：</label>-->
<!--                <div class="col-sm-6">-->
<!--                    <input name="bankCardFront" type="hidden" th:value="${merchant.bankCardFront}">-->
<!--                    <img th:src="${merchant.bankCardFront}" style="width: 300px;height: 200px;">-->
<!--                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label class="col-sm-3 control-label">上传银行卡反面：</label>-->
<!--                <div class="col-sm-6">-->
<!--                    <input name="bankCardBack" type="hidden" th:value="${merchant.bankCardBack}">-->
<!--                    <img th:src="${merchant.bankCardBack}" style="width: 300px;height: 200px;">-->
<!--                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label class="col-sm-3 control-label">上传门头照片：</label>-->
<!--                <div class="col-sm-6">-->
<!--                    <input name="doorHeadPhoto" type="hidden" th:value="${merchant.doorHeadPhoto}">-->
<!--                    <img th:src="${merchant.doorHeadPhoto}" style="width: 300px;height: 200px;">-->
<!--                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label class="col-sm-3 control-label">上传店内照片：</label>-->
<!--                <div class="col-sm-6">-->
<!--                    <input name="storePhotoOne" type="hidden" th:value="${merchant.storePhotoOne}">-->
<!--                    <img th:src="${merchant.storePhotoOne}" style="width: 300px;height: 200px;">-->
<!--                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label class="col-sm-3 control-label">上传店内照片：</label>-->
<!--                <div class="col-sm-6">-->
<!--                    <input name="storePhotoTwo" type="hidden" th:value="${merchant.storePhotoTwo}">-->
<!--                    <img th:src="${merchant.storePhotoTwo}" style="width: 300px;height: 200px;">-->
<!--                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">-->
<!--                </div>-->
<!--            </div>-->
            <div class="form-group">
                <label class="col-sm-3 control-label">上传营业执照：</label>
                <div class="col-sm-6">
                    <input name="businessLicense" type="hidden" th:value="${merchant.businessLicense}">
                    <img th:src="${merchant.businessLicense}" style="width: 300px;height: 200px;">
                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">
                </div>
            </div>
<!--            <div class="form-group" id="other" style="display: none;">-->
<!--                <label class="col-sm-3 control-label">上传其他照片：</label>-->
<!--                <div class="col-sm-6">-->
<!--                    <input name="otherPhoto" type="hidden" th:value="${merchant.otherPhoto}">-->
<!--                    <img th:src="${merchant.otherPhoto}" style="width: 300px;height: 200px;">-->
<!--                    <input type="file" class="form-control" accept="image/*" onchange="photoUpload(event)">-->
<!--                </div>-->
<!--            </div>-->
        </form>
    </div>
    <th:block th:include="include :: footer" />
    <script type="text/javascript">
        var prefix = ctx + "system/merchant";
        $("#form-merchant-edit").validate({
            focusCleanup: true
        });

        // function threeType() {
        //     var threeType = $("#three").val();
        //     var split = threeType.split(',');
        //     for (var three in split) {
        //         var checkId = "inlineCheckbox" + split[three];
        //         console.log(checkId)
        //         $("#" + checkId).attr('checked', 'true')
        //     }
        // }

        $(function () {
            var threeType = $("#three").val();
            var split = threeType.split(',');
            for (var three in split){
                var checkId = "inlineCheckbox" + split[three];
                console.log(checkId)
                $("#" + checkId).attr('checked','true')
            }
        });

        function submitHandler() {
            if ($.validate.form()) {
                $.operate.save(prefix + "/edit", $('#form-merchant-edit').serialize());
            }
        }

        function photoUpload(event) {
            var file = event.target.files[0];
            if (file) {
                var formData = new FormData();
                formData.append('file', file);
                $.ajax({
                    url: "/system/api/photoUpload",
                    data: formData,
                    type: "POST",
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        //成功
                        event.target.parentNode.children[1].src = data;
                        event.target.parentNode.children[0].value = data;
                    }
                });
            }
        }

        $(function () {
            selectMerchantType();
            getDistrictsById();
            getCitysById();
            getProvince();
        })

        function selectMerchantType(){
            var merchantType = $("#merchantType").val();
            if (merchantType == 3){
                $("#category").show();
                $("#other").show();
            }else{
                $("#category").hide();
                $("#other").hide();
            }
        }

        function getDistrictsById() {
            var city = $("#city1").val();
            var district = $("#district1").val();
            $.ajax({
                url: "/region/getDistrict/" + city,
                method: "POST",
                success: function (res) {
                    var data = res.data;
                    var _html = "";
                    for(var i = 0; i < data.length; i++){
                        if (district == data[i].id) {
                            _html += "<option value='" + data[i].id + "' selected='selected'>" + data[i].name + "</option>";
                        }else{
                            _html += "<option value='" + data[i].id + "'>" + data[i].name + "</option>";
                        }
                    }
                    $("#regionCode").html(_html);
                }
            });
        }

        function getCitysById() {
            var province = $("#province1").val();
            var city = $("#city1").val();
            $.ajax({
                url: "/region/getCity/" + province,
                method: "POST",
                success: function (res) {
                    var data = res.data;
                    var _html = "";
                    for(var i = 0; i < data.length; i++){
                        if (city == data[i].id) {
                            _html += "<option value='" + data[i].id + "' selected='selected'>" + data[i].name + "</option>";
                        }else{
                            _html += "<option value='" + data[i].id + "'>" + data[i].name + "</option>";
                        }
                    }
                    $("#city").html(_html);
                }
            });
        }

        function getProvince() {
            var province = $("#province1").val();
            $.ajax({
                url: "/region/getProvince",
                method: "POST",
                success: function (res) {
                    var data = res.data;
                    var _html = "";
                    for(var i = 0; i < data.length; i++){
                        if (province == data[i].id) {
                            _html += "<option value='" + data[i].id + "' selected='selected'>" + data[i].name + "</option>";
                        }else{
                            _html += "<option value='" + data[i].id + "'>" + data[i].name + "</option>";
                        }
                    }
                    $("#province").html(_html);
                }
            });
        }

        function getCity() {
            var province = $("#province").val();
            if (province){
                $.ajax({
                    url: "/region/getCity/" + province,
                    method: "POST",
                    success: function (res) {
                        var data = res.data;
                        var _html = "";
                        for(var i = 0; i < data.length; i++){
                            _html += "<option value='"+ data[i].id +"'>"+ data[i].name +"</option>";
                        }
                        $("#city").html(_html);
                        getDistrict();
                    }
                });
            }
        }

        function getDistrict() {
            var city = $("#city").val();
            if (city){
                $.ajax({
                    url: "/region/getDistrict/" + city,
                    method: "POST",
                    success: function (res) {
                        var data = res.data;
                        var _html = "";
                        for(var i = 0; i < data.length; i++){
                            _html += "<option value='"+ data[i].id +"'>"+ data[i].name +"</option>";
                        }
                        $("#regionCode").html(_html);
                    }
                });
            }
        }

        function threeLevelType() {
            debugger;
            var threeLevelType = $("#threeLevel").val();
            if (threeLevelType == 4) {
                $("#threeType").show();
            } else {
                $("#threeType").hide();
            }
        }

        // $(function () {
        //     $("#threeType").hide();
        // })
    </script>
</body>
</html>